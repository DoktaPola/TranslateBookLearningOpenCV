## [П]|[РС]|(РП) Последовательности

Одним из типов объектов, который может хранить хранилище является *последовательность*. Последовательности – это самостоятельно связанные списки разных структур. OpenCV может сделать последовательность из множества различных объектов. В этом смысле можно думать о последовательности как о нечто похожим на общий контейнер классов (или шаблон контейнера классов), который существует в различных языках программирования. Конструкция последовательности в OpenCV выглядит в виде симметричной очереди, так что это позволяет быстро получать произвольный доступ и добавлять/удалять объекты с любого конца очереди, но при этом немного медленнее в случае добавления и удаления объектов в середину очереди. 

Непосредственно внутри самой структуры (пример 8-1) есть некоторые важные элементы, о которых необходимо знать. Во-первых, чаще всего будет использоваться элемент *total*. Это общее количество точек или объектов в последовательности. Следующими четырьмя важными элементами являются указатели на другие последовательности: *h_prev*, *h_next*, *v_prev* и *v_next*. Эти четыре указателя являются частью так называемого элемента *CV_TREE_NODE_FIELDS*; они используются не для указания на элемент последовательности, они нужны для соединения различных последовательностей друг с другом. Другие объекты OpenCV так же содержат эти поля узлов дерева. Любые такие объекты могут быть собраны при помощи этих указателей в более сложные супер структуры такие, как списки, деревья и графы. Переменные *h_prev* и *h_next* могут быть использованы для создания простого связного списка. Другие две переменные *v_prev* и *v_next* могут быть использованы для создания более сложной топологии, которая связывает узлы друг с другом. Именно с помощью этих четырех указателей функция *cvFindContours() * способна представить все найденные контуры, составленные в сложную структуру в виде дерева контуров.

Пример 8-1. Внутренняя организация структуры последовательности CvSeq

```cpp
typedef struct CvSeq {
int flags; // различные флаги
int header_size; // размер заголовка последовательности
CvSeq* h_prev; // горизонтально-предыдущая последовательность
CvSeq* h_next; // горизонтально-следующая последовательность
CvSeq* v_prev; // вертикально-предыдущая последовательность
CvSeq* v_next // вертикально-следующая последовательность
int total; // общее количество элементов
int elem_size; // размер элемента последовательности в байтах
char* block_max; // максимальный предел последнего блока
char* ptr; // текущий указатель записи
int delta_elems; // сколько элементов выделять при росте последовательности
CvMemStorage* storage; // где хранить последовательность
CvSeqBlock* free_blocks; // список свободных блоков
CvSeqBlock* first; // указатель на первый блок последовательности
}
```