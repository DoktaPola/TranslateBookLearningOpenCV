## (П]|(РС)|(РП) Растягивание, сжатие, деформация и поворот

В этом разделе речь пойдет о геометрических манипуляциях над изображениями (об этих преобразования довольно таки подробно будет рассказано в этом разделе и в главе 11, когда они будут использованы в контексте трехмерного компьютерного зрения). Такие манипуляции включают в себя разтягивания в различных направлениях, при этом речь может идти как об однородных, так и об неоднородных изменениях размера (последнее более известно как *деформация*). Есть множество причин, чтобы выполнить эти операции: например, деформируя и поворачивая изображение так, чтобы уместить его в существующей сцене или для искусственного увеличения набора шаблонных изображений, используемых для распознавания объектов (это может показаться хитроумным; в конце концов, почему бы просто не использовать метод распознавания, инвариантный к локальным аффинным искажениям? Тем не менее, этот метод имеет долгую историю и до сих пор может быть весьма полезеным на практике). Функции, которые могут растягивать, сжимать, деформировать и/или поворачивать изображение именуются *геометрическими трансформациями*. Для плоскости есть две разновидности геометрических преобразований: преобразование, которое использует матрицу 2x3 и именуется *аффинным преобразованием*; и преобразование, которое испльзует матрицу 3x3 и именуется *перспективным преобразованием* или *гомографией*. Для последнего преобразования нужно представить, что оно основано на методе для вычисления пути, по которому в трехмерном измерении направлен взор конкретного наблюдателя, так как прямо взглянуть на эту плоскость он не может.

Аффинное преобразование как и любое преобразование может быть выражено в виде матричного умножения с последующим векторным сложением. В OpenCV стандартной  для таких преобразованиях является матрица размера 2x3. 

![Формула 6-14 не найдена](Images/Frml_6_14.jpg)

Нетрудно заметить, что эффект от аффинных преобразований **AX + B** в точности эквивалентно расширению вектора **X** до вектора **X'** и последующего левого умножения на вектор **T**. 

Аффинные преобразования могут быть визуализированы следующим образом: любой параллелограмм ABCD на плоскости может быть отражен в любой другой параллелограмм A'B'C'D'; если площади этих параллелограммов не равны нулю, то аффинные преобразования можно трактовать (по трем вершинам) однозначно. Так же для понимания аффиннного преобразования можно представить изображение в виде большого резиного листа, который в результате деформации нажатием или растягиванием (растягиванием так же можно инвертировать параллелограмм) за углы может быть преобразован в разнообразные параллелограммы. 

Имея несколько изображений одного объекта с разных ракурсов, можно применить фактическое преобразование для связывания различных ракурсов. В этом случае, зачастую для моделирования ракурсов используются аффинные преобразования, потому что задействуется малое количество параметров, что облегчает процесс вычисления. При этом недостатком является то, что реальные перспективные преобразования могут быть смоделированы только при помощи гомографии ("гомография" - это математический термин для отображения точек одной поверхности к точкам на другой поверхности. В контексте компьютерного зрения, под гомографией почти всегда имеется ввиду отображение между точками двух плоскостей изображений, которые соответствуют расположению объектов на плоскости в реальном мире. Такое преобразование представляется ортогональной матрицей 3x3 (подробнее об этом в главе 11)), так как аффинные преобразования дают представления, которые не могут вместить все возможные связи между ракурсами. С другой стороны, для небольших изменений в некоторых случаях аффинных преобразований вполне достаточно. 

За счет аффинного преобразования прямоугольник может быть преобразован в параллелограмм. При этом, в результате преобразований (вращения и/или масштабирования), стороны должны сохранять параллельность. Перспективные преобразования обеспечивают большую гибкость; прямоугольник может быть преобразован в трапецию. Так как параллелограмм это частный случай трапеции, то и аффинное преобразование это подмножество перспективного преобразования. На рисунке 6-13 представлены примеры различных аффинных и перспективных преобразований.

![Рисунок 6-13 не найден](Images/Pic_6_13.jpg)

Рисунок 6-13. Аффинные и перспективные преобразования

### Аффинные преобразования

Есть две ситуации, при которых используются аффинные преобразования. В первом случае выполнить преобразование изображения (или его части); во втором случае выполнить преобразование по списку точек.

#### Плотные аффинные преобразования

В первом случае, форматы исходного и конечного изображений очевидны, а неявное требование состоит в том, что деформация предполагаемых пикселей уплатняет представление основного изображения. Это означает, что деформирующееся изображение обязательно должно быть интерполировано чтобы конечное изображение было гладким и выглядело естественно. Функция OpenCV, отвечающая за аффинные преобразования, именуется *cvWarpAffine()*.

```cpp
	void cvWarpAffine(
		 const CvArr* 	src
		,CvArr* 		dst
		,const CvMat* 	map_matrix
		,int 			flags = CV_INTER_LINEAR | CV_WARP_FILL_OUTLIERS
		,CvScalar 		fillval = cvScalarAll(0)
	);
```

