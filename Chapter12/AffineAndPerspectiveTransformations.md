## (П]|(РС)|(РП) Аффинные и перспективные преобразования

Двумя наиболее используемыми преобразованиями являются аффинные и перспективные преобразования. Впервые об этом было сказано в главе 6. В зависимости от реализации соответствующих функций OpenCV оказывает влияние на список точек или на целое изображение, отображая точки, расположенные в одном месте, в другое место, при этом зачастую выполняя субпиксельную интерполяцию по пути. В результате аффинных преобразований из прямоугольников можно получить параллелограммы любой формы, а в результате перспективных преобразований (более общих) из прямоугольника можно получить трапецию любой формы.

*Перспективные преобразования* тесно связаны с *перспективным проецированием*. При перспективном проецировании карта точек трехмерного материального мира проецируется на двумерную плоскость изображения вдоль набора проекционных линий, сходящихся в так называемом центре проецирования. Перспективные преобразования, которые являются разновидностью *гомографии*, связывают два различных изображения, которые являются альтернативными проекциями одного и того же трехмерного объекта на двух различных *проекционных плоскостях* (и, таким образом, невырожденные формы, такие как материальная плоскость пересекающихся трехмерных объектов, как правило, имеют два различных центра проекции).

Эти функции проекционно связанных преобразований подробно обсуждались в главе 6; для удобства все полученные знания обобщены в таблице 12-1.

Таблица 12-1. Функции аффинных и перспективных преобразований

| Функция | Использование |
| -- | -- |
| cvTransform() | Аффинные преобразования списка точек |
| cvWarpAffine() | Аффинные преобразования целого изображения |
| cvGetAffineTransform() | Заполнение параметров матрицы аффинных преобразований |
| cv2DRotationMatrix() | Заполнение параметров матрицы аффинных преобразований |
| cvGetQuadrangleSubPix() | Низко затратные аффинные преобразования целого изображения |
| cvPerspectiveTransform() | Перспективные преобразования списка точек |
| cvWarpPerspective() | Перспективные преобразования целого изображения |
| cvGetPerspectiveTransform() | Заполнение параметров матрицы перспективных преобразований |

### Пример преобразования с высоты птичьего полета

Общей задачей по навигации в робототехнике, обычно используемой для планирования целей, является преобразование сцены взгляда камеры на роботе в представление с "высоты птичьего полета". На рисунке 12-1 представлено данное преобразование, которое впоследствии может быть покрыто альтернативным представлением мира, созданного при помощи сканирования лазерным дальномером. Далее, при использовании ранее полученных знаний, будет более детально показано, как использовать откалиброванную камеру для вычисления данного представления ("с высоты птичьего полёта").

![Рисунок 12-1 не найден](Images/Pic_12_1.jpg)

Рисунок 12-1. Представление с высоты птичьего полета: автомобильная камера смотрит на дорогу, где лазерный дальномер определяет область "дороги" в передней части автомобиля и выделяет участок прямоугольником (верхняя часть изображения); алгоритмы компьютерного зрения сегментируют данный участок (центральная часть изображения); сегментируемые участки дороги преобразуются в представление с высоты птичьего полёта, которое объединяется с представлением с высоты птичьего полета карты лазера (нижняя часть изображения)

Для получения представления с высоты птичьего полета (данная техника так же работает и для перспективных преобразований представлений любых плоскостей, например, стены или потолок, во фронтально параллельные представления) необходимы вычисленные в функции калибровки внутренние параметры камеры и матрицы искажений. Для разнообразия данные параметры будут читаться из файла на диске. Доска, положенная на пол, будет использована для получения горизонтальной плоскости изображения робота повозки; в последующем данное изображение преобразуется в изображение с высоты птичьего полета. Алгоритм работает следующим образом:

1. Чтение внутренних параметров и модели искажений для камеры.

2. Поиск известного объекта на горизонтальной плоскости (в данном случае шахматная доска). Получение как минимум четырех точек с субпиксельной точностью.

3. Ввод найденных точек в *cvGetPerspectiveTransform()* (глава 6) для вычисления матрицы гомографии H представления горизонтальной плоскости.

4. Использование *cvWarpPerspective()* (глава 6) с флагами *CV_INTER_LINEAR + CV_WARP_INVERSE_MAP + CV_WARP_FILL_OUTLIERS* для получения представления фронтально параллельного горизонтальной плоскости.

Пример 12-1 показывает полностью процесс получения представления с высоты птичьего полета.


