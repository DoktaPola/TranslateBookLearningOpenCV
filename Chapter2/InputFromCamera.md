## [П]|[РС]|(РП) Захват видео с камеры

В мире компьютеров, компьютерное зрение может означать множество связных с ним вещей. В некоторых случаях анализируются кадры, полученные из заранее неизвестного источника. В других, анализируется видео с диска. И наконец, возникает потребность в анализе видео потока в реальном времени, получаемого с камеры.

OpenCV - а точнее ее часть, *HighGUI* - помогает с легкостью справиться с подобного рода ситуациями. Подход схож с тем, как происходило чтение AVI файла. Вместо вызова *cvCreateFileCapture()*, используется *cvCreateCameraCapture()*. В качестве аргумента используется не имя файла, как ранее, а идентификационный номер камеры, и то имеет смысл его использовать, когда доступно сразу несколько камер. Значение по умолчанию равно -1, что означает "просто выбрать одну"; естественно, это работает, когда доступна только одна камера (см. Главу 4 для получения более подробной информации).

Функция *cvCreateCameraCapture()* возвращает указатель на структуру **CvCapture**, которая обрабатывается так же, как и в примере с обработкой видео файла с диска. Конечно, большая часть работы происходит "за кулисами" для того, чтобы изображение с камеры просматривалось как видео, все эти проблемы скрыты от пользователя. Нужно лишь захватить изображение с камеры, когда это потребуется. Для большинства разрабатываемых приложений требуется обеспечить видео поток в реальном времени, что при наличии уникальной структуры **CvCapture** с легкостью позволяет это сделать.

Пример 2-9. После инициализации переменной захвата, уже не важно, изображение с камеры или из файла

```cpp
...

CvCapture* capture; // Переменная захвата

if( 1 == argc ) {
    capture = cvCreateCameraCapture(0);	// Захват изображения с камеры
} 
else {
    capture = cvCreateFileCapture( argv[1] );	// Захват изображения из файла
}

assert( capture != NULL );	// Проверка успешного захвата

...
```

Пример 2-10. Простой пример вывода изображения, получаемого с камеры

```cpp
#include “highgui.h”
#include “cv.h”

int main() {
    CvCapture *capture = cvCreateCameraCapture(0); // Захват изображения с камеры

    // Проверка успешного захвата
    // 
    if( capture != NULL ) {
        IplImage *frame = NULL;                         // Кадр
        cvNamedWindow( "Сamera", CV_WINDOW_AUTOSIZE );  // Создание окна

        while( 1 ) {
            frame = cvQueryFrame( capture );    // Получение кадра, так же как и из видео файла
            
            if( !frame ) {                      // Конец файла, кадров больше нет
                break;
            }
            
            cvShowImage( "Сamera", frame );     // Отображение кадра
            char c = cvWaitKey(33);             // Ожидание 33 мс, получение ASCII кода клавиши нажатой клавиши
            
            if( 27 == c ) {                     // Если Esc - выход
                break;
            }
        }

        cvDestroyWindow( "Camera" ); // Уничтожение окна
    }

    // Очистка памяти
    // 
    cvReleaseCapture( &capture );
    
    return 0;
}
```

